<!-- 중고 피규어 거래 플랫폼 Nendoroo!-->
<!DOCTYPE html>
<html lang="ko">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
    <style>
        * {
            box-sizing: border-box;
        }
    </style>

    <title>넨도루 | 중고 피규어 거래소</title>
</head>

<body class="mx-auto">
    <nav class="mx-auto w-75 navbar navbar-expand-xxl navbar-light light mb-2">
        <div class="container-fluid">
            <a class="navbar-brand" href="/index.html"><img src="img/Nendoroo (250 × 100px).svg" alt="" srcset="" /></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse my-4" id="navbarSupportedContent">
                <form class="d-flex mx-auto" style="height: 3rem">
                    <input class="form-control me-2" type="search" placeholder="검색" aria-label="Search" />
                    <button class="btn btn-outline-secondary" type="submit">
                        Search
                    </button>
                </form>
                <ul class=" w-50 justify-content-evenly navbar-nav mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a style="font-size: larger; font-weight: bolder; color: black" class="nav-link"
                            href="/nendoroid.html">넨도로이드</a>
                    </li>
                    <li id="uploadbtn" class="nav-item">
                        <a style="font-size: larger; font-weight: bolder; color: black" class="nav-link"
                            href="/upload.html">판매하기</a>
                    </li>
                    <li id="mypagebtn" class="nav-item">
                        <a style="font-size: larger; font-weight: bolder; color: black" class="nav-link"
                            href="/mypage.html">마이페이지</a>
                    </li>
                    <!-- 평소에는 안보이고 있음 -->
                    <li id="logout" style="display: none;" class="nav-item">
                        <a id="logoutbtn" style="cursor: pointer; font-size: larger; font-weight: bolder; color: black"
                            class="nav-link">로그아웃</a>
                    </li>


                    <ul id="logindrop" class="navbar-nav">
                        <li class="nav-item dropdown">
                            <a style="font-weight: bolder; color: black; font-size: larger;"
                                class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                로그인
                            </a>
                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
                                <li class="my-3"><a id="google" class="dropdown-item p-3" href="#"
                                        style="display: inline;"><img style="margin-right: 1rem" width="25" height="25"
                                            src="img/google.svg" alt="">구글 로그인</a></li>

                            </ul>
                        </li>
                    </ul>


                </ul>
            </div>
        </div>
    </nav>
    <div style="background-color: #f9f9f9">
        <div class="container p-0">
            일단 가장 중요한건, 먼저 user라는 컬렉션을 만들고, 로그인한 사람의 정보가 저장되게 해야합니다.
            이때 처음가입한 사람이라면( 즉, user컬렉션안에 이사람의 고유정보(uid)가 없다면) 팝업창을 띄워서
            사용할 닉네임을 입력하게 합니다. 그러면, user컬렉션안에 그사람의 정보는 이메일,uid,닉네임 이렇게 3묶음으로 저장됩니다.
            마이페이지에서 자기 프로필에 보면, 닉네임이 나옵니다. 그리고 중고거래할때 그 닉네임을 씁니다.


            마이페이지입니다. 여기에는 판매 물품 / 구매 물품 / 찜한 물품 이렇게 총 3가지 카테고리가 있습니다
            그리고, 판매완료된 제품이나, 구매완료된 제품은, 판매완료표시,구매완료표시로 표시됩니다.
            판매하는 물품의 경우, 업로드한 물품을 삭제 할수있습니다.다만 수정 기능은 혼선을 막기위해 넣지 않습니다.

            제품카드를 누르면 해당 피규어의 디테일 페이지 ( 즉, 구매자들도 볼수있는 그 페이지 ) 로 이동함.

        </div>
        <!-- 큰 틀 -->
    </div>

    <!-- 제이쿼리 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

    <!-- firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBWX9DpbEhu3ZM9qsFuMwUgPDCODl5j3KI",
            authDomain: "nendoroo.firebaseapp.com",
            projectId: "nendoroo",
            storageBucket: "nendoroo.appspot.com",
            messagingSenderId: "544914137707",
            appId: "1:544914137707:web:32991f1ab2f60c87f6072e",
            measurementId: "G-NL1MPPR95L",
        };
        firebase.initializeApp(firebaseConfig);
    </script>

    <script>
        // 천자리수 콤마 함수
        // function priceToString(price) {
        //   return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        // }

        const db = firebase.firestore();


        //페이지 들어오자마자 검사한다. 로그인되어있다면, 로그아웃버튼 유지하는 로직

        firebase.auth().onAuthStateChanged((user) => {
            if (user) {

                // 로그인이 되었으니까,
                // 로그인버튼 안보이게하고
                $('#logindrop').hide();
                // 로그아웃버튼 보여주기
                $('#logout').show();
                // var uid = user.uid;

            } else {


            }
        });
        //
        //

        // 판매하기 , 마이페이지 버튼  클릭시, 로그인했는지 검사
        $("#uploadbtn").on("click", () => {
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    //로그인되어있으면 업로드페이지로 이동
                    window.location.href = "/upload.html";

                } else {

                    alert("로그인이 필요합니다");
                    window.location.href = "/index.html";
                }
            });
        })
        //
        $("#mypagebtn").on("click", () => {
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    //로그인되어있으면 업로드페이지로 이동
                    window.location.href = "/mypage.html";

                } else {

                    alert("로그인이 필요합니다");
                    window.location.href = "/index.html";
                }
            });
        })

        let provider = new firebase.auth.GoogleAuthProvider();

        // 구글로그인 클릭시
        $("#google").on("click", () => {
            firebase.auth()
                .signInWithPopup(provider)
                .then((result) => {



                    window.location.href = "/index.html";



                }).catch((error) => {

                });
        });

        $("#logout").on("click", () => {



            firebase.auth().signOut().then(() => {
                alert("로그아웃 되었습니다");

                window.location.href = "/index.html";
            }).catch((error) => {

            });
        });




    </script>
</body>

</html>